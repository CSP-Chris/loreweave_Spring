<!--
    File Name: register.html
    Created By: Wyatt Bechtle
    Created On: 9/15/2025
    Purpose: To provide registration capabilities to the Loreweave application

    Updated By: Jamie Coker on 9/21/2025
    Update Notes: Changed form action to Thymeleaf, added th:field bindings.

    Updated By: Wyatt Bechtle on 9/21/2025
    Update Notes: Updated form action to full path

    Updated By: Wyatt Bechtle on 9/26/2025
    Update Notes: Added first name, last name fields
                  Updated the styling and interaction of the form
                  Added CSRF protection
                  Added checkbox to show password
                  Created JS to toggle PW visibility

    Updated By: Wyatt Bechtle on 10/04/2025
    Update Notes: Changed loginBSF -> login
    Updated By: Jamie Coker on 10/27/2025
    Update Notes: Added Bootstrap alert boxes to show “email already in use” or “OTP resent.”
    Update: add ids on different section for styling purpose, actual code did not change
                Added footer
-->
<!doctype html>
<html lang="en" xmlns:th="https://www.thymeleaf.org/" data-bs-theme="dark">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>register</title>
      <link rel="stylesheet" th:href="@{/css/styles.css}">
    <!-- Bootstrap icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
          rel="stylesheet">
  </head>
  <!-- Page transition overlay -->
  <div id="page-transition"></div>

  <body class="login-body register-body">

  <header class="login-header">
      <h1 class="login-title">
          <a th:href="@{/}" class="header-link">Loreweave</a>
      </h1>
  </header>

  <main class="login-wrapper" style="background: transparent !important; box-shadow: none !important; border: none !important;">
      <div class="login-box">

      <form class="login-form"
                th:action="@{/api/auth/register}"
                th:object="${user}"
                method="post"
                novalidate>


          <!-- For spring security - prevents CSRF-->
            <input type="hidden" 
                   th:if="${_csrf != null}"
                   th:name="${_csrf.parameterName}"
                   th:value="${_csrf.token}"/>
            <h1 class="h3 text-center mb-4">
              <i class="bi bi-stars me-2"></i>Create your account
            </h1>

            <!--  ADDED: feedback message area -->
            <!-- ============================================= -->
            <!-- Displays success or error messages passed from AuthController -->
            <div th:if="${error}" class="alert alert-danger text-center" role="alert">
                <i class="bi bi-exclamation-triangle-fill me-2"></i>
                <span th:text="${error}"></span>
            </div>
            <div th:if="${message}" class="alert alert-success text-center" role="alert">
                <i class="bi bi-check-circle-fill me-2"></i>
                <span th:text="${message}"></span>
            </div>
            <!-- ============================================= -->

            <!--  First name -->
            <label for="firstname" 
                   class="form-label">First name</label>
            <input type="text"
                   class="form-control mb-3"
                   id="firstName"
                   th:field="*{firstName}"
                   placeholder="First name">
            <!--  Last name -->
            <label for="lastname" 
                   class="form-label">Last name</label>
            <input type="text"
                   class="form-control mb-3"
                   id="lastName"
                   th:field="*{lastName}"
                   placeholder="Last name">
            <!-- User name -->
            <label for="username" 
                   class="form-label">Username</label>
                <!--  Added th:field -->
                <input type="text"
                       class="form-control mb-2"
                       id="username"
                       th:field="*{username}"
                       placeholder="Username"
                       minlength="3"
                       required>
            <div class="form-text mb-3">3+ characters.</div>

            <!-- Email -->
            <label for="email" 
                   class="form-label">Email</label>
            <!--  Added th:field adding additional text for error resolution-->
            <input type="email"
                   class="form-control mb-3"
                   id="email"
                   th:field="*{email}"
                   placeholder="name@example.com"
                   required>
            <!-- Password -->
            <label for="password" 
                   class="form-label">Password</label>
            <!--  Added th:field -->
            <input type="password"
                  class="form-control"
                  id="password"
                  th:field="*{password}"
                  placeholder="Password"
                  minlength="8"
                  required>
              <div class="form-options">
                  <label for="showPW">
                      <input type="checkbox" id="showPW"> Show password
                  </label>
              </div>

              <div class="form-text mb-3">
          Minimum 8 characters.
        </div>
              <button type="submit" class="btn-login">Create Account </button>

            <p class="signup-text">
                Already have an account? <a th:href="@{/auth/login}">Sign in</a>
            </p>

        </form>
    </div>
  </main>
    <!-- Bootstrap JS link-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
            crossorigin="anonymous">
    </script>
    <!-- Toggles password visibility -->
    <script>
      const password = document.getElementById('password');
      const checkbox = document.getElementById('showPW');
      checkbox?.addEventListener('change', () => {password.type = checkbox.checked ? 'text' : 'password';});
    </script>
  <footer>
      <p>© 2025 Loreweave | Every player becomes an author.</p>
  </footer>

  <script>
      document.body.classList.add('fade-in');
      document.addEventListener('click', (e) => {
        const link = e.target.closest('a');
        if (link && link.href && link.target !== '_blank' && link.href.startsWith(window.location.origin)) {
          e.preventDefault();
          document.body.classList.add('fade-out');
          setTimeout(() => {
            window.location.href = link.href;
          }, 2500);
        }
      });
  </script>

  </body>
</html>
